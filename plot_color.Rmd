---
title: "plot_color"
output: html_document
---

```{r setup, include=FALSE}
library(tigris)
library(dplyr)
library(leaflet)
library(sp)
library(ggmap)
library(maptools)
library(broom)
library(httr)
library(rgdal)
```

```{r}
r = GET('http://data.beta.nyc//dataset/3bf5fb73-edb5-4b05-bb29-7c95f4a727fc/resource/6df127b1-6d04-4bb7-b983-07402a2c3f90/download/f4129d9aa6dd4281bc98d0f701629b76nyczipcodetabulationareas.geojson')
nyc_zipcode = readOGR(content(r,'text'), 'OGRGeoJSON', verbose = F)

#summary(nyc_zipcode)

#nyc_zipcode_df <-= tidy(nyc_zipcode)

leaflet(nyc_zipcode) %>%
  addTiles() %>% 
  addPolygons(popup = ~postalCode)
```


## geo_jion

```{r}
data_hiv = read.csv("./data/combine_hiv_new.csv") %>%
  filter(gender == "All", age == "All", race == "All")

diagnoses_by_zipcode = data_hiv %>% 
  group_by(zipcode, uhf) %>% 
  summarise(sum_hiv_diagnoses = sum(hiv_diagnoses))

map_data = geo_join(nyc_zipcode, diagnoses_by_zipcode, "postalCode", "zipcode")

```

## color

```{r}
pal = colorNumeric(palette = "Greens", domain = range(map_data@data$sum_hiv_diagnoses, na.rm = T))

leaflet(map_data) %>%
  addTiles() %>%  
  addPolygons(color = "black", weight = 0.5, opacity = 1, 
              fillColor = ~pal(sum_hiv_diagnoses), 
              popup = ~str_c(uhf, "sum:", factor(sum_hiv_diagnoses))) %>% 
#  addMarkers(~lng, ~lat, popup = ~postalCode, data = points) %>%  #factor(sum_hiv_diagnoses)
  addProviderTiles("CartoDB.Positron") %>%
  setView(-73.98, 40.75, zoom = 11)

```

